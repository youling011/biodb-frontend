openapi: 3.0.3
info:
  title: BioStoichDB API
  version: "v1"
servers:
  - url: /stoichiometry
paths:
  /:
    get:
      summary: List samples
      parameters:
        - in: query
          name: q
          schema: { type: string }
        - in: query
          name: omics
          schema: { type: string }
        - in: query
          name: taxonomy
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
      responses:
        "200":
          description: Sample list
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SampleList"
  /{id}/rows/:
    get:
      summary: Paged rows
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
        - in: query
          name: omics
          schema: { type: string }
        - in: query
          name: limit
          schema: { type: integer }
        - in: query
          name: offset
          schema: { type: integer }
        - in: query
          name: fields
          schema: { type: string }
        - in: query
          name: sort_by
          schema: { type: string }
        - in: query
          name: sort_dir
          schema: { type: string }
        - in: query
          name: filter
          schema: { type: string }
      responses:
        "200":
          description: Row page
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RowsPage"
  /{id}/transcriptome_qc/:
    get:
      summary: Transcriptome QC
      responses:
        "200":
          description: QC payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TranscriptomeQC"
  /{id}/transcriptome_hvg/:
    get:
      summary: Transcriptome HVG
      responses:
        "200":
          description: HVG payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TranscriptomeHVG"
  /{id}/transcriptome_de/:
    get:
      summary: Transcriptome DE
      responses:
        "200":
          description: DE payload
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TranscriptomeDE"
  /{id}/summary_vector/:
    get:
      summary: Omics summary vector
      parameters:
        - in: query
          name: omics
          schema: { type: string }
      responses:
        "200":
          description: Summary vector
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SummaryVector"
  /jobs/:
    post:
      summary: Create async job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JobRequest"
      responses:
        "200":
          description: Job created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobStatus"
  /jobs/{jobId}/:
    get:
      summary: Job status
      parameters:
        - in: path
          name: jobId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Job status
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/JobStatus"
  /jobs/{jobId}/result/:
    get:
      summary: Job result
      parameters:
        - in: path
          name: jobId
          required: true
          schema: { type: string }
      responses:
        "200":
          description: Job result
          content:
            application/json:
              schema:
                type: object
components:
  schemas:
    Sample:
      type: object
      properties:
        id: { type: integer }
        species_name: { type: string }
        taxonomy: { type: string }
        omics_type: { type: string }
    SampleList:
      type: object
      properties:
        items:
          type: array
          items: { $ref: "#/components/schemas/Sample" }
        total: { type: integer }
        limit: { type: integer }
        offset: { type: integer }
        schema_version: { type: string }
      required: [items, total, limit, offset]
    RowsPage:
      type: object
      properties:
        rows:
          type: array
          items: { type: object }
        pagination:
          type: object
          properties:
            total: { type: integer }
            offset: { type: integer }
            limit: { type: integer }
        schema_version: { type: string }
      required: [rows, pagination]
    TranscriptomeQC:
      type: object
      properties:
        qc_metrics: { type: array, items: { type: object } }
        normalization: { type: object }
        meta: { type: object }
    TranscriptomeHVG:
      type: object
      properties:
        points: { type: array, items: { type: object } }
        hvg_table: { type: array, items: { type: object } }
        meta: { type: object }
    TranscriptomeDE:
      type: object
      properties:
        de_table: { type: array, items: { type: object } }
        meta: { type: object }
    SummaryVector:
      type: object
      properties:
        sample_id: { type: integer }
        omics: { type: string }
        vector: { type: object }
    JobRequest:
      type: object
      properties:
        type: { type: string }
        params: { type: object }
      required: [type]
    JobStatus:
      type: object
      properties:
        id: { type: string }
        status: { type: string }
        progress: { type: number }
        message: { type: string }
        created_at: { type: string }
        updated_at: { type: string }
